var LocationModel=function(e,o,n,a){var t=this;t.name=e,t.position={lng:n,lat:o},t.fourSquareId=a,t.marker=null},dataPoints=[new LocationModel("Beverly Street",6.890622,79.858873,"4c26f4ed3703d13a175da636"),new LocationModel("Barista",6.910408,79.861888,"4ba06f61f964a520986d37e3"),new LocationModel("Baskin Robins",6.907677,79.850826,"4be3f02921d5a593a6391a11"),new LocationModel("Sinhalese Sports Club",6.90575,79.869462,"53c28e2b498ed626a1253248"),new LocationModel("Cinnamon Grand Colombo",6.9179,79.848445,"4bd10754b221c9b66c02d5d0")],LocationDetailModel=function(){var e=this;e.locationName=ko.observable(""),e.bestPhoto=ko.observable(""),e.phone=ko.observable(""),e.detailSource=ko.observable(""),e.unformattedAdressArray=ko.observableArray([]),e.address=ko.pureComputed(function(){var o="";return $.each(e.unformattedAdressArray(),function(e,n){o=o+"<br>"+n}),o},e)},ControlAreaViewModel=function(){var e=this;e.searchText=ko.observable(""),e.locations=ko.observableArray(dataPoints),e.openMenu=ko.observable(!1),openSearchMenu=function(){e.openMenu(!0)},closeSearchMenu=function(){e.openMenu(!1)},onSearchResultClick=function(e){fourSquareHandler.getDetails(e)},e.onLocationDetailModelUpdate=function(e){googleMapHandler.triggerLocationDetailView($("#info-window").html(),e)},e.searchText.subscribe(function(o){var n=[],a={};$.each(dataPoints,function(t,i){e._isSearchTextFound(o,i.name)&&(n.push(i),a[i.position.lng+"_"+i.position.lat]=i)}),e.locations(n),googleMapHandler.populateDataPoints(a)}),e._isSearchTextFound=function(e,o){var n=o.split(" "),a=!1;return $.each(n,function(o,n){0===n.toLowerCase().indexOf(e.toLowerCase())&&(a=!0)}),a}},locationDetailModel=new LocationDetailModel,controlAreaViewModel=new ControlAreaViewModel;ko.applyBindings(locationDetailModel,document.getElementById("info-window")),ko.applyBindings(controlAreaViewModel,document.getElementById("control-area"));var GoogleMapHandler=function(){var e={lat:6.9092478,lng:79.856681},o=function(){return new google.maps.Map($("#map")[0],{center:e,zoom:8,mapTypeControl:!1})},n=function(e){return new google.maps.Marker({position:e.position,draggable:!0,animation:google.maps.Animation.DROP,map:map,title:e.name})},a=function(){fourSquareHandler.getDetails(this)},t=function(){this.marker.setAnimation(null),this.marker=null};return{map:null,infoWindow:null,bounds:null,initLocation:e,initMap:function(){map=o(),infoWindow=new google.maps.InfoWindow({}),infoWindow.addListener("closeclick",t.bind(infoWindow)),bounds=new google.maps.LatLngBounds,this.populateDataPoints()},populateDataPoints:function(e){var o;for(i=0;i<dataPoints.length;i++){var t=dataPoints[i];e?(o=t.marker,e[t.position.lng+"_"+t.position.lat]?t.marker.setVisible(!0):t.marker.setVisible(!1)):(o=n(t),t.marker=o,o.addListener("click",a.bind(t))),bounds.extend(o.position)}map.fitBounds(bounds)},triggerLocationDetailView:function(e,o){infoWindow.marker!==o.marker&&(infoWindow.marker=o.marker,infoWindow.marker.setAnimation(google.maps.Animation.BOUNCE),infoWindow.setContent(e),infoWindow.open(map,o.marker))}}},googleMapHandler=new GoogleMapHandler,FourSquareHandler=function(){var e=function(e){console.error(e),alert(e)},o=function(e){var o={error:!0,message:""};return e?e.meta?e.meta.code?e.response?e.response.venue?o.error=!1:o.message="No Venu information on response Object":o.message="No Response Object":o.message="No Code Avaialable":o.message="No Meta Object":o.message="No Data Object",o},n=function(e,o){var n=e.response.venue;locationDetailModel.locationName(o.name),locationDetailModel.bestPhoto(n.bestPhoto.prefix+"height80"+n.bestPhoto.suffix),locationDetailModel.phone(n.contact.phone),locationDetailModel.detailSource(n.canonicalUrl),locationDetailModel.unformattedAdressArray(n.location.formattedAddress),controlAreaViewModel.onLocationDetailModelUpdate(o)};return{endPoint:"https://api.foursquare.com/v2/venues/",client_id:"GHBSVU3SHG14OOJ4A5ICR0X04HGAETGF3U1LP2RHRR3ZFWTR",client_secret:"XZDHWHZDPSODIZN3ARGDKUKWXCCHUQEJ1A1F2O2032LD3VHT",version:"20170801",getDetails:function(a){$.ajax({type:"GET",url:this.endPoint+a.fourSquareId,dataType:"json",cache:!1,locationModel:a,data:{client_id:this.client_id,client_secret:this.client_secret,v:this.version},success:function(a){var t=o(a);t.error?e(t.message):n(a,this.locationModel)},error:function(o,n,a){var t;t=a?"Error status: "+(n=n||"Not Specified")+"     Message: "+a:"Unknown Error occured",e(t)}})}}},fourSquareHandler=new FourSquareHandler;